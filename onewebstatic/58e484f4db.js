window.OnewebContactForm=function(a){var b,c=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};return b=function(a){try{this.init(a)}catch(b){throw new Error("ContactForm Validation initialization failed")}},b.prototype={constructor:window.OnewebContactForm,init:function(b){this.formDOMId=b.formDOMId,this.postURL=b.postURL,this.recipientEmail=decodeURIComponent(b.recipientEmail),this.successMessage=decodeURIComponent(b.successMessage),this.errorMessage=decodeURIComponent(b.errorMessage),this.formElementsErrorMessages=JSON.parse(b.formElementsErrorMessages),this.allFieldErrorMessage=JSON.parse(b.allFieldErrorMessage),this.emailRegex=new RegExp(b.emailRegex,"i"),this.urlRegex=new RegExp(b.urlRegex),this.numberRegex=/^[0-9+\(\)#\.\s]+$/,this.numberQuery='input[ctype="number"]',this.previewMode=b.previewMode,this.attachSubmitEvent(),this.attachNumberInputValidation(),this.formFieldErrors=[],this.contactFormDOM={},this.formData={recipient:this.recipientEmail,email:this.recipientEmail,subject:decodeURIComponent(b.subject)},this.defaultFormData=a.extend({},this.formData),this.originalCharset=this.getDocumentCharset(),this.attachSubmitEvent()},attachSubmitEvent:function(){a('.oneWebCntForm input[type="submit"]').click(a.proxy(this.validateForm,this))},attachNumberInputValidation:function(){var b=this.numberRegex;a(".contact-form-field-container > "+this.numberQuery).on("input",function(){var c=a(this),d=c.val();if(!b.test(d)){var e="[^"+b.source.replace(/^\^\[(.*?)\]\+\$$/,"$1")+"]",f=d.replace(new RegExp(e,"g"),"");c.val(f)}})},validateForm:function(b){if(b.preventDefault(),b.stopImmediatePropagation(),this.removeSuccessMessageOnFormFields(a("#contactFormResponseContainer")),this.contactFormDOM=a(".oneWebCntForm"),this.removeErrorMessageWarningOnFormFields(this.contactFormDOM),this.setDocumentCharset("ISO-8859-1"),0!==this.getFormValidationErrors(this.contactFormDOM)){var c=a(".contact-form-field-container .error-message")[0];return c&&c.scrollIntoView(),this.setDocumentCharset(this.originalCharset),!1}this.updateFormData(this.contactFormDOM),this.isHiddenFieldEmpty()&&!this.previewMode&&(this.postContactForm(),this.formData=a.extend(!0,{},this.defaultFormData))},removeErrorMessageWarningOnFormFields:function(b){a(b).find(".error-message").remove()},removeSuccessMessageOnFormFields:function(b){a(b).html("").removeClass("formSuccess")},getFormValidationErrors:function(b){var d=b.find(".contact-form-field-container"),e=this.emailRegex,f=this.urlRegex,g=/^\S*/g,h=this.numberRegex,i=0;return a.each(d,a.proxy(function(b,d){var j,k,l=this.formElementsErrorMessages[b],m=!1,n=a(d).find(this.numberQuery),o=1===n.length;if(l=l&&decodeURIComponent(l),a(d).find('input[type="text"]')[0]&&!o&&l)k=a.trim(a(d).find('input[type="text"]').val()),!k.length&&k.match(g)&&(m=!0);else if(a(d).find('input[type="email"]')[0])j=a(d).find('input[type="email"]').val(),(l||j)&&(l=l||decodeURIComponent(this.allFieldErrorMessage[b]),e.test(j)||(m=!0));else if(a(d).find('input[type="url"]')[0])j=a(d).find('input[type="url"]').val(),(l||j)&&(l=l||decodeURIComponent(this.allFieldErrorMessage[b]),f.test(j)||f.test("http://"+j)||(m=!0));else if(o)j=n.val(),(l||j)&&(l=l||decodeURIComponent(this.allFieldErrorMessage[b]),j.match(h)||(m=!0));else if(a(d).find('input[type="tel"]')[0])j=a(d).find('input[type="tel"]').val(),(l||j)&&(l=l||decodeURIComponent(this.allFieldErrorMessage[b]),j.match(h)||(m=!0));else if(a(d).find('input[type="checkbox"]').length>0&&l)a(d).find('input[type="checkbox"]:checked')[0]||(m=!0);else if(a(d).find('input[type="radio"]').length>0&&l)a(d).find('input[type="radio"]:checked')[0]||(m=!0);else if(a(d).find("textarea")[0]&&l)k=a.trim(a(d).find("textarea").val()),!k.length&&k.match(g)&&(m=!0);else if(a(d).find("select")[0]&&l){var p=a(d).find("select").val();p||"--"===p||(m=!0)}var q=a(d).next();m?(q.html(c(l)),i+=1):q.html("&nbsp;")},this)),i},updateFormData:function(b){var c=a(b).find(".contact-form-field-container");a.each(c,a.proxy(function(b,c){var d=a(c).find("label").text().replace(" *","");a(c).find('input[type="text"]')[0]||a(c).find('input[type="url"]')[0]||a(c).find(this.numberQuery)[0]||a(c).find('input[type="tel"]')[0]?this.formData[d]=a(c).find("input").val():a(c).find('input[type="email"]')[0]?(d="email"===d?"Email":d,this.formData.replyto?this.formData[d]=a(c).find("input").val():this.formData.replyto=this.formData[d]=a(c).find("input").val()):a(c).find('input[type="checkbox"]:checked')[0]?this.formData[d]=a(c).find('input[type="checkbox"]:checked').map(function(b,c){return a(c).val()}).get():a(c).find('input[type="radio"]:checked')[0]?this.formData[d]=a(c).find('input[type="radio"]:checked').val():a(c).find("select")[0]?this.formData[d]=a(c).find("select").val():a(c).find("textarea")[0]&&(this.formData[d]=a(c).find("textarea").val())},this))},getEncodedFormData:function(){var a="";for(var b in this.formData)a+=unescape(encodeURIComponent(escape(b))).replace(/\+/g,"%2B")+"="+unescape(encodeURIComponent(escape(this.formData[b]))).replace(/\+/g,"%2B")+"&";return a=a.substring(0,a.length-1)},isHiddenFieldEmpty:function(){return""===a(this.contactFormDOM).find(".oneweb-hidden-field>input").text()},postContactForm:function(){a.ajax({type:"POST",url:this.postURL,beforeSend:function(a){a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")},data:this.getEncodedFormData(),success:a.proxy(this.ajaxSuccess,this),error:a.proxy(this.ajaxError,this)})},ajaxSuccess:function(b){var d=a("#contactFormResponseContainer");/<title>\s*Error/i.test(b)?a(d).html(c(this.errorMessage)).addClass("formError").removeClass("formSuccess"):a(d).html(c(this.successMessage)).addClass("formSuccess").removeClass("formError"),this.resetDocument()},ajaxError:function(){var b=a("#contactFormResponseContainer");a(b).html(this.errorMessage).addClass("formError")},resetDocument:function(){a(this.contactFormDOM).trigger("reset"),this.setDocumentCharset(this.originalCharset)},getDocumentCharset:function(){return document.characterSet||document.charset},setDocumentCharset:function(a){document.charset?document.charset=a:document.characterSet=a}},b}(oneJQuery);